{"version":3,"sources":["../src/chooseavatar.js"],"names":["define","$","Config","Str","ModalFactory","ModalEvents","Fragment","Ajax","Swal","ChooseAvatar","selector","contextid","init","prototype","modal","triggers","get_string","then","title","create","type","types","DEFAULT","body","getBody","large","bind","getRoot","on","hidden","setBody","shown","append","avatarSelected","formdata","params","jsonformdata","JSON","stringify","loadFragment","handleFormSubmissionResponse","data","hide","item","parse","useravatar","attr","console","log","Toast","mixin","toast","position","showConfirmButton","timer","timerProgressBar","onOpen","addEventListener","stopTimer","resumeTimer","fire","icon","message","handleFormSubmissionFailure","e","preventDefault","avatarid","currentTarget","call","methodname","args","done","fail"],"mappings":"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","sourcesContent":["/**\n * Create section js logic.\n *\n * @package    mod_evokeportfolio\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n\n/* eslint-disable no-console */\ndefine([\n        'jquery',\n        'core/config',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/fragment',\n        'core/ajax',\n        'local_evokegame/sweetalert'],\n    function($, Config, Str, ModalFactory, ModalEvents, Fragment, Ajax, Swal) {\n        /**\n         * Constructor for the ChooseAvatar.\n         *\n         * @param selector The selector to open the modal\n         * @param contextid The course module contextid\n         * @param portfolioid The portfolio id\n         */\n        var ChooseAvatar = function(selector, contextid) {\n            this.contextid = contextid;\n\n            this.init(selector);\n        };\n\n        /**\n         * @var {Modal} modal\n         * @private\n         */\n        ChooseAvatar.prototype.modal = null;\n\n        /**\n         * @var {int} contextid\n         * @private\n         */\n        ChooseAvatar.prototype.contextid = -1;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method init\n         */\n        ChooseAvatar.prototype.init = function(selector) {\n            var triggers = $(selector);\n\n            return Str.get_string('chooseavatar', 'local_evokegame').then(function(title) {\n                // Create the modal.\n                return ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: title,\n                    body: this.getBody(),\n                    large: true\n                }, triggers);\n            }.bind(this)).then(function(modal) {\n                // Keep a reference to the modal.\n                this.modal = modal;\n\n                // We want to reset the form every time it is opened.\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    this.modal.setBody(this.getBody());\n                }.bind(this));\n\n                // We want to hide the submit buttons every time it is opened.\n                this.modal.getRoot().on(ModalEvents.shown, function() {\n                    this.modal.getRoot().append('<style>[data-fieldtype=submit] { display: none ! important; }</style>');\n                }.bind(this));\n\n                // We also catch the form submit event and use it to submit the form with ajax.\n                this.modal.getRoot().on('click', '.chooseavatar-form img.avatar', this.avatarSelected.bind(this));\n\n                return this.modal;\n            }.bind(this));\n        };\n\n        /**\n         * @method getBody\n         *\n         * @private\n         *\n         * @return {Promise}\n         */\n        ChooseAvatar.prototype.getBody = function(formdata) {\n            if (typeof formdata === \"undefined\") {\n                formdata = {};\n            }\n\n            // Get the content of the modal.\n            var params = {jsonformdata: JSON.stringify(formdata)};\n\n            return Fragment.loadFragment('local_evokegame', 'chooseavatar_form', this.contextid, params);\n        };\n\n        /**\n         * @method handleFormSubmissionResponse\n         *\n         * @private\n         *\n         * @return {Promise}\n         */\n        ChooseAvatar.prototype.handleFormSubmissionResponse = function(data) {\n            this.modal.hide();\n\n            var item = JSON.parse(data.data);\n\n            var useravatar = $('#evokegame-user-avatar');\n\n            useravatar.attr('src', item);\n\n            console.log(item);\n\n            var Toast = Swal.mixin({\n                toast: true,\n                position: 'top-end',\n                showConfirmButton: false,\n                timer: 8000,\n                timerProgressBar: true,\n                onOpen: (toast) => {\n                    toast.addEventListener('mouseenter', Swal.stopTimer);\n                    toast.addEventListener('mouseleave', Swal.resumeTimer);\n                }\n            });\n\n            Toast.fire({\n                icon: 'success',\n                title: data.message\n            });\n        };\n\n        /**\n         * @method handleFormSubmissionFailure\n         *\n         * @private\n         *\n         * @return {Promise}\n         */\n        ChooseAvatar.prototype.handleFormSubmissionFailure = function() {\n            // Oh noes! Epic fail :(\n            // Ah wait - this is normal. We need to re-display the form with errors!\n            this.modal.setBody(this.getBody());\n        };\n\n        /**\n         * Private method\n         *\n         * @method avatarSelected\n         *\n         * @private\n         *\n         * @param {Event} e Form submission event.\n         */\n        ChooseAvatar.prototype.avatarSelected = function(e) {\n            // We don't want to do a real form submission.\n            e.preventDefault();\n\n            var avatarid = $(e.currentTarget).data('id');\n\n            Ajax.call([{\n                methodname: 'local_evokegame_chooseavatar',\n                args: {contextid: this.contextid, avatarid: avatarid},\n                done: this.handleFormSubmissionResponse.bind(this),\n                fail: this.handleFormSubmissionFailure.bind(this)\n            }]);\n        };\n\n        return {\n            init: function(selector, contextid) {\n                return new ChooseAvatar(selector, contextid);\n            }\n        };\n    }\n);\n"],"file":"chooseavatar.min.js"}