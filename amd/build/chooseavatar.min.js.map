{"version":3,"file":"chooseavatar.min.js","sources":["../src/chooseavatar.js"],"sourcesContent":["/**\n * Create section js logic.\n *\n * @package    mod_evokeportfolio\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n\ndefine([\n        'jquery',\n        'core/config',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/fragment',\n        'core/ajax',\n        'local_evokegame/sweetalert'],\n    function($, Config, Str, ModalFactory, ModalEvents, Fragment, Ajax, Swal) {\n        /**\n         * Constructor for the ChooseAvatar.\n         *\n         * @param selector The selector to open the modal\n         * @param contextid The course module contextid\n         * @param portfolioid The portfolio id\n         */\n        var ChooseAvatar = function(selector, contextid) {\n            this.contextid = contextid;\n\n            this.init(selector);\n        };\n\n        /**\n         * @var {Modal} modal\n         * @private\n         */\n        ChooseAvatar.prototype.modal = null;\n\n        /**\n         * @var {int} contextid\n         * @private\n         */\n        ChooseAvatar.prototype.contextid = -1;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method init\n         */\n        ChooseAvatar.prototype.init = function(selector) {\n            var triggers = $(selector);\n\n            return Str.get_string('chooseavatar', 'local_evokegame').then(function(title) {\n                // Create the modal.\n                return ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: title,\n                    body: this.getBody(),\n                    large: true\n                }, triggers);\n            }.bind(this)).then(function(modal) {\n                // Keep a reference to the modal.\n                this.modal = modal;\n\n                // We want to reset the form every time it is opened.\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    this.modal.setBody(this.getBody());\n                }.bind(this));\n\n                // We want to hide the submit buttons every time it is opened.\n                this.modal.getRoot().on(ModalEvents.shown, function() {\n                    this.modal.getRoot().append('<style>[data-fieldtype=submit] { display: none ! important; }</style>');\n                }.bind(this));\n\n                // We also catch the form submit event and use it to submit the form with ajax.\n                this.modal.getRoot().on('click', '.chooseavatar-form img.avatar', this.avatarSelected.bind(this));\n\n                return this.modal;\n            }.bind(this));\n        };\n\n        /**\n         * @method getBody\n         *\n         * @private\n         *\n         * @return {Promise}\n         */\n        ChooseAvatar.prototype.getBody = function(formdata) {\n            if (typeof formdata === \"undefined\") {\n                formdata = {};\n            }\n\n            // Get the content of the modal.\n            var params = {jsonformdata: JSON.stringify(formdata)};\n\n            return Fragment.loadFragment('local_evokegame', 'chooseavatar_form', this.contextid, params);\n        };\n\n        /**\n         * @method handleFormSubmissionResponse\n         *\n         * @private\n         *\n         * @return {Promise}\n         */\n        ChooseAvatar.prototype.handleFormSubmissionResponse = function(data) {\n            this.modal.hide();\n\n            var item = JSON.parse(data.data);\n\n            var useravatar = $('#evokegame-user-avatar');\n            useravatar.attr('src', item);\n\n            var navuserimg = $('.usermenu .userpicture');\n            navuserimg.attr('src', item);\n\n            var Toast = Swal.mixin({\n                toast: true,\n                position: 'top-end',\n                showConfirmButton: false,\n                timer: 8000,\n                timerProgressBar: true,\n                onOpen: (toast) => {\n                    toast.addEventListener('mouseenter', Swal.stopTimer);\n                    toast.addEventListener('mouseleave', Swal.resumeTimer);\n                }\n            });\n\n            Toast.fire({\n                icon: 'success',\n                title: data.message\n            });\n        };\n\n        /**\n         * @method handleFormSubmissionFailure\n         *\n         * @private\n         *\n         * @return {Promise}\n         */\n        ChooseAvatar.prototype.handleFormSubmissionFailure = function() {\n            // Oh noes! Epic fail :(\n            // Ah wait - this is normal. We need to re-display the form with errors!\n            this.modal.setBody(this.getBody());\n        };\n\n        /**\n         * Private method\n         *\n         * @method avatarSelected\n         *\n         * @private\n         *\n         * @param {Event} e Form submission event.\n         */\n        ChooseAvatar.prototype.avatarSelected = function(e) {\n            // We don't want to do a real form submission.\n            e.preventDefault();\n\n            var avatarid = $(e.currentTarget).data('id');\n\n            Ajax.call([{\n                methodname: 'local_evokegame_chooseavatar',\n                args: {contextid: this.contextid, avatarid: avatarid},\n                done: this.handleFormSubmissionResponse.bind(this),\n                fail: this.handleFormSubmissionFailure.bind(this)\n            }]);\n        };\n\n        return {\n            init: function(selector, contextid) {\n                return new ChooseAvatar(selector, contextid);\n            }\n        };\n    }\n);\n"],"names":["define","$","Config","Str","ModalFactory","ModalEvents","Fragment","Ajax","Swal","ChooseAvatar","selector","contextid","init","prototype","modal","triggers","get_string","then","title","create","type","types","DEFAULT","body","this","getBody","large","bind","getRoot","on","hidden","setBody","shown","append","avatarSelected","formdata","params","jsonformdata","JSON","stringify","loadFragment","handleFormSubmissionResponse","data","hide","item","parse","attr","mixin","toast","position","showConfirmButton","timer","timerProgressBar","onOpen","addEventListener","stopTimer","resumeTimer","fire","icon","message","handleFormSubmissionFailure","e","preventDefault","avatarid","currentTarget","call","methodname","args","done","fail"],"mappings":"AAQAA,sCAAO,CACC,SACA,cACA,WACA,qBACA,oBACA,gBACA,YACA,+BACJ,SAASC,EAAGC,OAAQC,IAAKC,aAAcC,YAAaC,SAAUC,KAAMC,UAQ5DC,aAAe,SAASC,SAAUC,gBAC7BA,UAAYA,eAEZC,KAAKF,kBAOdD,aAAaI,UAAUC,MAAQ,KAM/BL,aAAaI,UAAUF,WAAa,EAOpCF,aAAaI,UAAUD,KAAO,SAASF,cAC/BK,SAAWd,EAAES,iBAEVP,IAAIa,WAAW,eAAgB,mBAAmBC,KAAK,SAASC,cAE5Dd,aAAae,OAAO,CACvBC,KAAMhB,aAAaiB,MAAMC,QACzBJ,MAAOA,MACPK,KAAMC,KAAKC,UACXC,OAAO,GACRX,WACLY,KAAKH,OAAOP,KAAK,SAASH,mBAEnBA,MAAQA,WAGRA,MAAMc,UAAUC,GAAGxB,YAAYyB,OAAQ,gBACnChB,MAAMiB,QAAQP,KAAKC,YAC1BE,KAAKH,YAGFV,MAAMc,UAAUC,GAAGxB,YAAY2B,MAAO,gBAClClB,MAAMc,UAAUK,OAAO,0EAC9BN,KAAKH,YAGFV,MAAMc,UAAUC,GAAG,QAAS,gCAAiCL,KAAKU,eAAeP,KAAKH,OAEpFA,KAAKV,OACda,KAAKH,QAUXf,aAAaI,UAAUY,QAAU,SAASU,eACd,IAAbA,WACPA,SAAW,QAIXC,OAAS,CAACC,aAAcC,KAAKC,UAAUJ,kBAEpC7B,SAASkC,aAAa,kBAAmB,oBAAqBhB,KAAKb,UAAWyB,SAUzF3B,aAAaI,UAAU4B,6BAA+B,SAASC,WACtD5B,MAAM6B,WAEPC,KAAON,KAAKO,MAAMH,KAAKA,MAEVzC,EAAE,0BACR6C,KAAK,MAAOF,MAEN3C,EAAE,0BACR6C,KAAK,MAAOF,MAEXpC,KAAKuC,MAAM,CACnBC,OAAO,EACPC,SAAU,UACVC,mBAAmB,EACnBC,MAAO,IACPC,kBAAkB,EAClBC,OAASL,QACLA,MAAMM,iBAAiB,aAAc9C,KAAK+C,WAC1CP,MAAMM,iBAAiB,aAAc9C,KAAKgD,gBAI5CC,KAAK,CACPC,KAAM,UACNxC,MAAOwB,KAAKiB,WAWpBlD,aAAaI,UAAU+C,4BAA8B,gBAG5C9C,MAAMiB,QAAQP,KAAKC,YAY5BhB,aAAaI,UAAUqB,eAAiB,SAAS2B,GAE7CA,EAAEC,qBAEEC,SAAW9D,EAAE4D,EAAEG,eAAetB,KAAK,MAEvCnC,KAAK0D,KAAK,CAAC,CACPC,WAAY,+BACZC,KAAM,CAACxD,UAAWa,KAAKb,UAAWoD,SAAUA,UAC5CK,KAAM5C,KAAKiB,6BAA6Bd,KAAKH,MAC7C6C,KAAM7C,KAAKoC,4BAA4BjC,KAAKH,UAI7C,CACHZ,KAAM,SAASF,SAAUC,kBACd,IAAIF,aAAaC,SAAUC"}