{"version":3,"sources":["../src/deliverbadge.js"],"names":["define","$","Ajax","Str","Swal","STRINGS","CONFIRM_TITLE","CONFIRM_MSG","CONFIRM_YES","CONFIRM_NO","SUCCESS","componentStrings","key","component","DeliverBadge","getStrings","append","registerEventListeners","prototype","stringsPromise","get_strings","when","done","strings","on","event","preventDefault","eventTarget","currentTarget","fire","title","text","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","cancelButtonText","then","result","value","callDelivery","bind","show","request","call","methodname","args","badge","id","data","response","reloadPage","message","fail","error","hide","showToast","type","Toast","mixin","toast","position","showConfirmButton","timer","timerProgressBar","onOpen","addEventListener","stopTimer","resumeTimer"],"mappings":"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","sourcesContent":["/**\n * Delete badge js logic.\n *\n * @copyright  2021 World Bank Group <https://worldbank.org>\n * @author     Willian Mano <willianmanoaraujo@gmail.com>\n */\n\ndefine(['jquery', 'core/ajax', 'core/str', 'local_evokegame/sweetalert'], function($, Ajax, Str, Swal) {\n    var STRINGS = {\n        CONFIRM_TITLE: 'Are you sure?',\n        CONFIRM_MSG: 'Once delivered, the badge cannot be revoked!',\n        CONFIRM_YES: 'Yes, deliver it!',\n        CONFIRM_NO: 'Cancel',\n        SUCCESS: 'Chapter successfully delivered.'\n    };\n\n    var componentStrings = [\n        {\n            key: 'deliverbadge_confirm_title',\n            component: 'local_evokegame'\n        },\n        {\n            key: 'deliverbadge_confirm_msg',\n            component: 'local_evokegame'\n        },\n        {\n            key: 'deliverbadge_confirm_yes',\n            component: 'local_evokegame'\n        },\n        {\n            key: 'deliverbadge_confirm_no',\n            component: 'local_evokegame'\n        },\n        {\n            key: 'deliverbadge_success',\n            component: 'local_evokegame'\n        },\n    ];\n\n    var DeliverBadge = function() {\n        this.getStrings();\n\n        $('body').append('<div id=\"evokegame-fullscreenloading\"></div>');\n\n        this.registerEventListeners();\n    };\n\n    DeliverBadge.prototype.getStrings = function() {\n        var stringsPromise = Str.get_strings(componentStrings);\n\n        $.when(stringsPromise).done(function(strings) {\n            STRINGS.CONFIRM_TITLE = strings[0];\n            STRINGS.CONFIRM_MSG = strings[1];\n            STRINGS.CONFIRM_YES = strings[2];\n            STRINGS.CONFIRM_NO = strings[3];\n            STRINGS.SUCCESS = strings[4];\n        });\n    };\n\n    DeliverBadge.prototype.registerEventListeners = function() {\n        $(\"body\").on(\"click\", \".deliver-evokegame-badge\", function(event) {\n            event.preventDefault();\n\n            var eventTarget = $(event.currentTarget);\n\n            Swal.fire({\n                title: STRINGS.CONFIRM_TITLE,\n                text: STRINGS.CONFIRM_MSG,\n                icon: 'warning',\n                showCancelButton: true,\n                confirmButtonColor: '#3085d6',\n                cancelButtonColor: '#d33',\n                confirmButtonText: STRINGS.CONFIRM_YES,\n                cancelButtonText: STRINGS.CONFIRM_NO\n            }).then(function(result) {\n                if (result.value) {\n                    this.callDelivery(eventTarget);\n                }\n            }.bind(this));\n        }.bind(this));\n    };\n\n    DeliverBadge.prototype.callDelivery = function(eventTarget) {\n        $('#evokegame-fullscreenloading').show();\n\n        var request = Ajax.call([{\n            methodname: 'local_evokegame_deliverbadge',\n            args: {\n                badge: {\n                    id: eventTarget.data('id')\n                }\n            }\n        }]);\n\n        request[0].done(function(response) {\n            this.reloadPage(response.message);\n        }.bind(this)).fail(function(error) {\n            $('#evokegame-fullscreenloading').hide();\n\n            var message = error.message;\n\n            if (!message) {\n                message = error.error;\n            }\n\n            this.showToast('error', message);\n        }.bind(this));\n    };\n\n    DeliverBadge.prototype.reloadPage = function(message) {\n        $('#evokegame-fullscreenloading').hide();\n\n        this.showToast('success', message);\n    };\n\n    DeliverBadge.prototype.showToast = function(type, message) {\n        var Toast = Swal.mixin({\n            toast: true,\n            position: 'top-end',\n            showConfirmButton: false,\n            timer: 8000,\n            timerProgressBar: true,\n            onOpen: (toast) => {\n                toast.addEventListener('mouseenter', Swal.stopTimer);\n                toast.addEventListener('mouseleave', Swal.resumeTimer);\n            }\n        });\n\n        Toast.fire({\n            icon: type,\n            title: message\n        });\n    };\n\n    return {\n        'init': function() {\n            return new DeliverBadge();\n        }\n    };\n});"],"file":"deliverbadge.min.js"}